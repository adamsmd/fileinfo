#!/bin/sh

# Ensure that a c compiler and make are installed.  (This script is mostly to
# for Docker containers, which often don't have these already installed.)

note_using="Installing dependencies using"

if apt-get --version >/dev/null 2>&1; then
  echo "$note_using" apt-get
  export DEBIAN_FRONTEND=noninteractive
  apt-get update
  apt-get install --assume-yes make
  apt-get install --assume-yes gcc \
    || apt-get install --assume-yes gcc5 # For Alma Linux p8
elif tdnf --version >/dev/null 2>&1; then
  echo "$note_using" tdnf
  tdnf install --assumeyes gcc make
  # Fixes for Photon Linux
  tdnf erase --assumeyes toybox || true
  tdnf install --assumeyes coreutils sed gawk binutils glibc-devel linux-api-headers || true
elif yum --version >/dev/null 2>&1; then
  echo "$note_using" yum
  yum install --assumeyes gcc make
elif pacman --version >/dev/null 2>&1; then
  echo "$note_using" pacman
  yes | pacman --sync --refresh gcc make
elif apk --version >/dev/null 2>&1; then
  echo "$note_using" apk
  apk add --no-cache gcc libc-dev make
elif swupd --version >/dev/null 2>&1; then
  echo "$note_using" swupd
  swupd bundle-add --assume=yes c-basic make
elif urpmi --version >/dev/null 2>&1; then
  echo "$note_using" swupd
  urpmi --auto gcc make
elif opkg --version >/dev/null 2>&1; then
  echo "$note_using" opkg
  mkdir /var/lock || true
  opkg update
  opkg install diffutils gcc make
elif microdnf --help 2>/dev/null 2>&1; then
  echo "$note_using" microdnf
  microdnf install --assumeyes gcc make
else
  echo "$note_using" '<nothing>'
fi
