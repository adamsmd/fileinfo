#!/bin/bash

# WARNING: This script takes a long time to run (~2 hours)

set -e
shopt -s nullglob

TMP="$(mktemp --tmpdir --directory libinfo-update-ax-tmp.XXXXXXXXXX)"

(cd "$TMP" && git clone https://git.savannah.gnu.org/git/autoconf-archive.git)

rm m4/ax_*.m4{,.hide}
cp "$TMP"/autoconf-archive/m4/* m4/

rm -rf "$TMP"

for i in m4/ax_*.m4; do
  echo !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  echo !!!! Checking $i
  echo !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  mv $i $i.hide
  bin/clean
  if bin/bootstrap && ./configure; then
    echo ''
    echo !!!! Hiding $i
    echo ''
  else
    echo ''
    echo !!!! Keeping $i
    mv $i.hide $i
    echo ''
  fi

done

rm m4/ax_*.m4.hide
